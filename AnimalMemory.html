<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animal Memory - 2 Players</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
        }

        h1 {
            color: #ff6b6b;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 5px;
        }

        h2 {
            color: #4a4a4a;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .score-board {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 600px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .player {
            text-align: center;
            flex: 1;
            padding: 10px;
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .player.active {
            background-color: #ffd166;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .player-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .player-score {
            font-size: 1.8rem;
            color: #ff6b6b;
        }

        .game-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 500px;
            width: 100%;
            margin-bottom: 20px;
        }

        .card {
            aspect-ratio: 1;
            perspective: 1000px;
            cursor: pointer;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-front {
            background-color: white;
            color: #333;
            transform: rotateY(180deg);
            overflow: hidden;
            padding: 5px;
        }

        .card-front img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .card-back {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            color: white;
            font-size: 2rem;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            background-color: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        button:hover {
            background-color: #ff5252;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        button:active {
            transform: translateY(0);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .modal h3 {
            color: #ff6b6b;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }

        .modal p {
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .quiz-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .quiz-option {
            padding: 10px 20px;
            background-color: #a8edea;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .quiz-option:hover {
            background-color: #7de0dc;
            transform: scale(1.05);
        }

        .winner-modal .modal-content {
            background: linear-gradient(135deg, #ffd166 0%, #ff9a9e 100%);
        }

        .winner-modal h3 {
            color: #4a4a4a;
            font-size: 2.5rem;
        }

        .winner-modal p {
            font-size: 1.5rem;
            margin: 20px 0;
        }

        #quiz-question {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 20px 0;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 600px) {
            .game-container {
                grid-template-columns: repeat(4, 1fr);
                max-width: 90vw;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .score-board {
                flex-direction: column;
                gap: 10px;
            }
            
            .controls {
                flex-direction: column;
                width: 100%;
                max-width: 300px;
            }
            
            .card-back {
                font-size: 1.5rem;
            }
            
            #quiz-question {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Animal Memory - 2 Players</h1>
        <h2>Match pairs, answer the quiz to score!</h2>
    </header>

    <div class="score-board">
        <div class="player player1 active">
            <div class="player-name">Player 1</div>
            <div class="player-score" id="player1-score">0</div>
        </div>
        <div class="player player2">
            <div class="player-name">Player 2</div>
            <div class="player-score" id="player2-score">0</div>
        </div>
    </div>

    <div class="game-container" id="game-board">
        <!-- Cards will be generated by JavaScript -->
    </div>

    <div class="controls">
        <button id="new-game">New Game</button>
        <button id="pass-turn">Pass Turn</button>
        <button id="help">Help</button>
    </div>

    <!-- Quiz Modal -->
    <div class="modal" id="quiz-modal">
        <div class="modal-content">
            <h3>Is/Are Quiz!</h3>
            <p id="quiz-question">__ this a cat?</p>
            <div class="quiz-options">
                <div class="quiz-option" data-answer="is">is</div>
                <div class="quiz-option" data-answer="are">are</div>
                <div class="quiz-option" data-answer="am">am</div>
            </div>
        </div>
    </div>

    <!-- Winner Modal -->
    <div class="modal winner-modal" id="winner-modal">
        <div class="modal-content">
            <h3>Game Over!</h3>
            <p id="winner-message">Player 1 wins with 5 points!</p>
            <button id="play-again">Play Again</button>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="help-modal">
        <div class="modal-content">
            <h3>How to Play</h3>
            <p><strong>Goal:</strong> Match all animal pairs and answer grammar questions correctly.</p>
            <p><strong>Gameplay:</strong></p>
            <ul style="text-align: left; margin: 15px 0;">
                <li>Players take turns flipping two cards</li>
                <li>If they match, answer an is/are/am question</li>
                <li>Correct answer = 1 point and another turn</li>
                <li>Wrong answer = no point, next player's turn</li>
                <li>Game ends when all pairs are matched</li>
            </ul>
            <button id="close-help">Got it!</button>
        </div>
    </div>

    <script>
        // Game state
        const gameState = {
            cards: [],
            flippedCards: [],
            matchedPairs: 0,
            currentPlayer: 1,
            scores: {1: 0, 2: 0},
            canFlip: true,
            quizQuestions: [
                { question: "__ this a cat?", answer: "is" },
                { question: "They __ birds.", answer: "are" },
                { question: "This __ a turtle.", answer: "is" },
                { question: "We __ happy.", answer: "are" },
                { question: "I __ a student.", answer: "am" },
                { question: "She __ my friend.", answer: "is" },
                { question: "You __ tall.", answer: "are" },
                { question: "He __ running.", answer: "is" },
                { question: "It __ raining.", answer: "is" },
                { question: "They __ playing.", answer: "are" },
                { question: "We __ going to the park.", answer: "are" },
                { question: "I __ eating an apple.", answer: "am" }
            ],
            animals: [
                { 
                    name: "cat", 
                    image: "https://i.postimg.cc/FFT89tdj/kot.png"
                },
                { 
                    name: "dog", 
                    image: "https://i.postimg.cc/Qxp6HRHj/sobaka.png"
                },
                { 
                    name: "rabbit", 
                    image: "https://i.postimg.cc/k5wFxCmq/krolik.png"
                },
                { 
                    name: "bear", 
                    image: "https://i.postimg.cc/mDXvpKQ4/1765198219.png"
                },
                { 
                    name: "panda", 
                    image: "https://i.postimg.cc/BQcgqHww/panda.png"
                },
                { 
                    name: "tiger", 
                    image: "https://i.postimg.cc/3RvXzvGJ/tigr.png"
                },
                { 
                    name: "lion", 
                    image: "https://i.postimg.cc/5tmpnv85/lev.png"
                },
                { 
                    name: "giraffe", 
                    image: "https://i.postimg.cc/13wvVbXQ/ziraf.png"
                }
            ],
            imagesLoaded: 0,
            totalImages: 16
        };

        // DOM Elements
        const gameBoard = document.getElementById('game-board');
        const player1Score = document.getElementById('player1-score');
        const player2Score = document.getElementById('player2-score');
        const player1Element = document.querySelector('.player1');
        const player2Element = document.querySelector('.player2');
        const newGameButton = document.getElementById('new-game');
        const passTurnButton = document.getElementById('pass-turn');
        const helpButton = document.getElementById('help');
        const quizModal = document.getElementById('quiz-modal');
        const quizQuestion = document.getElementById('quiz-question');
        const quizOptions = document.querySelectorAll('.quiz-option');
        const winnerModal = document.getElementById('winner-modal');
        const winnerMessage = document.getElementById('winner-message');
        const playAgainButton = document.getElementById('play-again');
        const helpModal = document.getElementById('help-modal');
        const closeHelpButton = document.getElementById('close-help');

        // Initialize the game
        function initGame() {
            gameState.matchedPairs = 0;
            gameState.currentPlayer = 1;
            gameState.scores = {1: 0, 2: 0};
            gameState.flippedCards = [];
            gameState.canFlip = true;
            gameState.imagesLoaded = 0;
            
            updateScores();
            updatePlayerTurn();
            createCards();
        }

        // Create and shuffle cards
        function createCards() {
            gameBoard.innerHTML = '';
            gameState.cards = [];
            
            // Show loading state
            gameBoard.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 20px;">Loading images... <div class="loading"></div></div>';
            
            // Create pairs of cards
            const cardPairs = [];
            gameState.animals.forEach(animal => {
                cardPairs.push(animal, animal);
            });
            
            // Shuffle cards
            shuffleArray(cardPairs);
            
            // Create card elements
            cardPairs.forEach((animal, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.index = index;
                
                const cardInner = document.createElement('div');
                cardInner.className = 'card-inner';
                
                const cardFront = document.createElement('div');
                cardFront.className = 'card-front';
                
                const img = document.createElement('img');
                img.src = animal.image;
                img.alt = animal.name;
                img.onload = () => {
                    gameState.imagesLoaded++;
                    if (gameState.imagesLoaded === gameState.totalImages) {
                        // All images loaded, enable game
                        gameState.canFlip = true;
                    }
                };
                img.onerror = () => {
                    // If image fails to load, show emoji as fallback
                    cardFront.innerHTML = `<span style="font-size: 2.5rem;">${getAnimalEmoji(animal.name)}</span>`;
                    gameState.imagesLoaded++;
                    if (gameState.imagesLoaded === gameState.totalImages) {
                        gameState.canFlip = true;
                    }
                };
                
                cardFront.appendChild(img);
                
                const cardBack = document.createElement('div');
                cardBack.className = 'card-back';
                cardBack.textContent = '?';
                
                cardInner.appendChild(cardFront);
                cardInner.appendChild(cardBack);
                card.appendChild(cardInner);
                
                card.addEventListener('click', () => flipCard(card, index));
                gameBoard.appendChild(card);
                
                gameState.cards.push({
                    element: card,
                    animal: animal,
                    isFlipped: false,
                    isMatched: false
                });
            });
        }

        // Get emoji fallback for animals
        function getAnimalEmoji(animalName) {
            const emojiMap = {
                'cat': 'üê±',
                'dog': 'üê∂',
                'rabbit': 'üê∞',
                'bear': 'üêª',
                'panda': 'üêº',
                'tiger': 'üêØ',
                'lion': 'ü¶Å',
                'giraffe': 'ü¶í'
            };
            return emojiMap[animalName] || '‚ùì';
        }

        // Flip card function
        function flipCard(cardElement, index) {
            const card = gameState.cards[index];
            
            if (!gameState.canFlip || card.isFlipped || card.isMatched) return;
            
            // Flip the card
            cardElement.classList.add('flipped');
            card.isFlipped = true;
            gameState.flippedCards.push(card);
            
            // Check if two cards are flipped
            if (gameState.flippedCards.length === 2) {
                gameState.canFlip = false;
                
                const card1 = gameState.flippedCards[0];
                const card2 = gameState.flippedCards[1];
                
                // Check for match
                if (card1.animal.name === card2.animal.name) {
                    // Match found
                    setTimeout(() => {
                        card1.isMatched = true;
                        card2.isMatched = true;
                        gameState.matchedPairs++;
                        
                        // Show quiz
                        showQuiz();
                        
                        gameState.flippedCards = [];
                        gameState.canFlip = true;
                    }, 1000);
                } else {
                    // No match
                    setTimeout(() => {
                        card1.element.classList.remove('flipped');
                        card2.element.classList.remove('flipped');
                        card1.isFlipped = false;
                        card2.isFlipped = false;
                        
                        gameState.flippedCards = [];
                        gameState.canFlip = true;
                        
                        // Switch player
                        switchPlayer();
                    }, 1500);
                }
            }
        }

        // Show quiz modal
        function showQuiz() {
            const randomQuestion = gameState.quizQuestions[
                Math.floor(Math.random() * gameState.quizQuestions.length)
            ];
            
            quizQuestion.textContent = randomQuestion.question;
            quizModal.style.display = 'flex';
            
            // Store correct answer for comparison
            quizModal.dataset.correctAnswer = randomQuestion.answer;
        }

        // Switch player turn
        function switchPlayer() {
            gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;
            updatePlayerTurn();
        }

        // Update player turn indicator
        function updatePlayerTurn() {
            if (gameState.currentPlayer === 1) {
                player1Element.classList.add('active');
                player2Element.classList.remove('active');
            } else {
                player1Element.classList.remove('active');
                player2Element.classList.add('active');
            }
            
            // ARIA live update for accessibility
            const ariaLiveRegion = document.createElement('div');
            ariaLiveRegion.setAttribute('aria-live', 'polite');
            ariaLiveRegion.setAttribute('aria-atomic', 'true');
            ariaLiveRegion.style.position = 'absolute';
            ariaLiveRegion.style.left = '-10000px';
            ariaLiveRegion.textContent = `Player ${gameState.currentPlayer}'s turn`;
            document.body.appendChild(ariaLiveRegion);
            setTimeout(() => {
                document.body.removeChild(ariaLiveRegion);
            }, 100);
        }

        // Update scores display
        function updateScores() {
            player1Score.textContent = gameState.scores[1];
            player2Score.textContent = gameState.scores[2];
        }

        // Check for game end
        function checkGameEnd() {
            if (gameState.matchedPairs === gameState.animals.length) {
                // Game over
                let winner;
                if (gameState.scores[1] > gameState.scores[2]) {
                    winner = "Player 1";
                } else if (gameState.scores[2] > gameState.scores[1]) {
                    winner = "Player 2";
                } else {
                    winner = "It's a tie!";
                }
                
                winnerMessage.textContent = `${winner} wins with ${Math.max(gameState.scores[1], gameState.scores[2])} points!`;
                winnerModal.style.display = 'flex';
            }
        }

        // Utility function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Event Listeners
        newGameButton.addEventListener('click', initGame);
        
        passTurnButton.addEventListener('click', () => {
            if (gameState.flippedCards.length === 0) {
                switchPlayer();
            }
        });
        
        helpButton.addEventListener('click', () => {
            helpModal.style.display = 'flex';
        });
        
        closeHelpButton.addEventListener('click', () => {
            helpModal.style.display = 'none';
        });
        
        playAgainButton.addEventListener('click', () => {
            winnerModal.style.display = 'none';
            initGame();
        });
        
        // Quiz option selection
        quizOptions.forEach(option => {
            option.addEventListener('click', () => {
                const selectedAnswer = option.dataset.answer;
                const correctAnswer = quizModal.dataset.correctAnswer;
                
                if (selectedAnswer === correctAnswer) {
                    // Correct answer
                    gameState.scores[gameState.currentPlayer]++;
                    updateScores();
                    
                    // Show correct feedback
                    option.style.backgroundColor = '#90EE90';
                    setTimeout(() => {
                        quizModal.style.display = 'none';
                        option.style.backgroundColor = '';
                        
                        // Player continues their turn
                        checkGameEnd();
                    }, 1000);
                } else {
                    // Wrong answer
                    option.style.backgroundColor = '#FFB6C1';
                    setTimeout(() => {
                        quizModal.style.display = 'none';
                        option.style.backgroundColor = '';
                        
                        // Switch player
                        switchPlayer();
                        checkGameEnd();
                    }, 1000);
                }
            });
        });
        
        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === quizModal) {
                quizModal.style.display = 'none';
            }
            if (e.target === winnerModal) {
                winnerModal.style.display = 'none';
            }
            if (e.target === helpModal) {
                helpModal.style.display = 'none';
            }
        });
        
        // Close modals with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                quizModal.style.display = 'none';
                winnerModal.style.display = 'none';
                helpModal.style.display = 'none';
            }
        });

        // Initialize the game when page loads
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
	<script>
  // –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  const result = { score: 100, completed: true };
  
  // –í–∞—Ä–∏–∞–Ω—Ç 1: —á–µ—Ä–µ–∑ opener
  if (window.opener) {
    window.opener.receiveResult(result);
    window.close();
  }
  
  // –í–∞—Ä–∏–∞–Ω—Ç 2: —á–µ—Ä–µ–∑ postMessage (–±–æ–ª–µ–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π)
  window.parent.postMessage({
    type: 'MODAL_SUBMIT',
    data: result
  }, '*');
</script>
<!-- –ö–æ–¥ –¥–ª—è —Å–≤—è–∑–∏ —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –æ–∫–Ω–æ–º -->
<script>
// ============================================
// –ö–û–î –î–õ–Ø –°–í–Ø–ó–ò –° –†–û–î–ò–¢–ï–õ–¨–°–ö–ò–ú –û–ö–ù–û–ú
// –í—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞, –ø–µ—Ä–µ–¥ </body>
// ============================================

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏–≥—Ä
const gameConfig = {
    'AnimalMemory': {
        name: 'board',
        completionCondition: function() {
            // –î–ª—è AnimalMemory: –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥—É
            if (typeof gameWon !== 'undefined' && gameWon) return true;
            
            // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ–±–µ–¥—ã
            const winElements = document.querySelectorAll('.win, .victory, .success, [class*="win"], [class*="victory"]');
            if (winElements.length > 0) return true;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if (document.body.innerText.includes('You win') || 
                document.body.innerText.includes('Congratulations') ||
                document.body.innerText.includes('Well done')) {
                return true;
            }
            
            return false;
        }
    },
    'GameFruit': {
        name: 'tablet',
        completionCondition: function() {
            // –î–ª—è GameFruit: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—á–µ—Ç –∏–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
            if (typeof score !== 'undefined' && score >= 100) return true;
            if (typeof gameCompleted !== 'undefined' && gameCompleted) return true;
            
            // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
            const completeElements = document.querySelectorAll('.complete, .finished, .end');
            if (completeElements.length > 0) return true;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—Å—Ç
            if (document.body.innerText.includes('Level completed') || 
                document.body.innerText.includes('Game completed') ||
                document.body.innerText.includes('Finished')) {
                return true;
            }
            
            return false;
        }
    },
    'IrregularVerbs': {
        name: 'play',
        completionCondition: function() {
            // –î–ª—è IrregularVerbs Maze: –ø—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
            if (typeof mazeCompleted !== 'undefined' && mazeCompleted) return true;
            if (typeof levelPassed !== 'undefined' && levelPassed) return true;
            
            // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ª–∞–±–∏—Ä–∏–Ω—Ç–∞
            const mazeComplete = document.querySelectorAll('.maze-complete, .exit-reached, .finish');
            if (mazeComplete.length > 0) return true;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—Å—Ç
            if (document.body.innerText.includes('Maze completed') || 
                document.body.innerText.includes('You escaped') ||
                document.body.innerText.includes('Congratulations')) {
                return true;
            }
            
            return false;
        }
    }
};

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é –∏–≥—Ä—É
function getCurrentGame() {
    const url = window.location.href.toLowerCase();
    const title = document.title.toLowerCase();
    
    if (url.includes('animalmemory') || title.includes('animal') || title.includes('memory')) {
        return gameConfig['AnimalMemory'];
    } else if (url.includes('gamefruit') || title.includes('fruit')) {
        return gameConfig['GameFruit'];
    } else if (url.includes('irregularverbs') || title.includes('maze') || title.includes('verbs')) {
        return gameConfig['IrregularVerbs'];
    }
    
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
    return {
        name: 'unknown',
        completionCondition: function() { return false; }
    };
}
// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–∏–≤—ã–π —ç–∫—Ä–∞–Ω –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
function showCongratulations() {
    console.log('Showing congratulations screen');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ —É–∂–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
    if (document.getElementById('congratulations-overlay')) {
        console.log('Congratulations overlay already showing');
        return;
    }
    
    // –°–∫—Ä—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–±–µ–¥—ã
    const winnerModal = document.getElementById('winner-modal');
    if (winnerModal) {
        winnerModal.style.display = 'none';
        console.log('Original winner modal hidden');
    }
    
    // –°–æ–∑–¥–∞–µ–º –æ–≤–µ—Ä–ª–µ–π
    const overlay = document.createElement('div');
    overlay.id = 'congratulations-overlay';
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 999999;
        color: white;
        font-family: 'Arial', sans-serif;
        text-align: center;
        padding: 20px;
        animation: fadeIn 0.5s ease-out;
    `;
    
    // –°–æ–∑–¥–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    `;
    document.head.appendChild(style);
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∏–≥—Ä—ã
    let winnerText = "Congratulations!";
    try {
        const winnerMessage = document.getElementById('winner-message');
        if (winnerMessage) {
            winnerText = winnerMessage.textContent || "Congratulations!";
        }
    } catch (e) {
        console.log('Could not get winner message:', e);
    }
    
    // –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
    overlay.innerHTML = `
        <div style="font-size: 80px; margin-bottom: 20px; animation: bounce 2s infinite;">
            üêæ
        </div>
        <h1 style="font-size: 42px; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
            ${winnerText}
        </h1>
        <p style="font-size: 24px; margin-bottom: 30px; max-width: 600px; line-height: 1.5;">
            You matched all the animal pairs!<br>
            Fantastic memory, kitty!
        </p>
        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin: 20px 0; backdrop-filter: blur(10px);">
            <p style="font-size: 18px; margin: 10px 0;">üß† Memory game completed!</p>
            <p style="font-size: 18px; margin: 10px 0;">‚≠ê All 8 pairs matched!</p>
            <p style="font-size: 18px; margin: 10px 0;">üê± Your teacher will be proud!</p>
        </div>
        <button id="backButton" style="
            background: #27ae60;
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 22px;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            animation: pulse 2s infinite;
        ">
            üè´ Back to Classroom
        </button>
        <p style="margin-top: 20px; font-size: 16px; color: rgba(255,255,255,0.8);">
            Press ESC or click the button above to return
        </p>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    document.body.appendChild(overlay);
    console.log('Congratulations overlay added');
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ Back
    document.getElementById('backButton').addEventListener('click', function() {
        console.log('Back button clicked');
        this.style.background = '#229954';
        this.style.transform = 'scale(0.95)';
        
        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–∫—Ä—ã—Ç—å –∏–≥—Ä—É —á–µ—Ä–µ–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ
        try {
            window.parent.postMessage({ 
                type: 'CLOSE_GAME',
                gameName: 'board'
            }, '*');
            console.log('Close message sent to parent');
        } catch (error) {
            console.log('Could not notify parent, closing locally');
            overlay.style.opacity = '0';
            overlay.style.transition = 'opacity 0.5s';
            setTimeout(() => {
                overlay.remove();
                // –ú–æ–∂–µ–º –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                if (window === window.top) {
                    alert('Game completed! In the full version, this would return to the classroom.');
                }
            }, 500);
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à–∏ Escape
    const escapeHandler = function(e) {
        if (e.key === 'Escape') {
            document.getElementById('backButton').click();
        }
    };
    document.addEventListener('keydown', escapeHandler);
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
    document.body.style.overflow = 'hidden';
    console.log('Congratulations screen fully setup');
}
// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
function notifyGameCompletion() {
    const game = getCurrentGame();
    console.log('Game completion detected for:', game.name);
    
    try {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—é
        window.parent.postMessage({ 
            type: 'GAME_COMPLETED', 
            success: true,
            gameName: game.name,
            timestamp: new Date().toISOString()
        }, '*');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
        showCongratulations();
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º true –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        return true;
    } catch (error) {
        console.error('Error notifying parent:', error);
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
        showCongratulations();
        return false;
    }
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–∏–≤—ã–π —ç–∫—Ä–∞–Ω –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
function showCongratulations() {
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —ç–∫—Ä–∞–Ω –µ—Å–ª–∏ –µ—Å—Ç—å
    const existing = document.getElementById('congratulations-overlay');
    if (existing) existing.remove();
    
    // –°–æ–∑–¥–∞–µ–º –æ–≤–µ—Ä–ª–µ–π
    const overlay = document.createElement('div');
    overlay.id = 'congratulations-overlay';
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 99999;
        color: white;
        font-family: 'Arial', sans-serif;
        text-align: center;
        padding: 20px;
        animation: fadeIn 0.5s ease-out;
    `;
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    `;
    document.head.appendChild(style);
    
    // –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
    overlay.innerHTML = `
        <div style="font-size: 80px; margin-bottom: 20px; animation: bounce 2s infinite;">
            üéâ
        </div>
        <h1 style="font-size: 42px; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
            Congratulations!
        </h1>
        <p style="font-size: 24px; margin-bottom: 30px; max-width: 600px; line-height: 1.5;">
            You have successfully completed the game!<br>
            Well done, kitty!
        </p>
        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin: 20px 0; backdrop-filter: blur(10px);">
            <p style="font-size: 18px; margin: 10px 0;">üéÆ Game completed successfully</p>
            <p style="font-size: 18px; margin: 10px 0;">‚≠ê Great job!</p>
            <p style="font-size: 18px; margin: 10px 0;">üê± Your teacher will be proud!</p>
        </div>
        <button id="backButton" style="
            background: #27ae60;
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 22px;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            animation: pulse 2s infinite;
        ">
            üè´ Back to Classroom
        </button>
        <p style="margin-top: 20px; font-size: 16px; color: rgba(255,255,255,0.8);">
            Press ESC or click the button above to return
        </p>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    document.body.appendChild(overlay);
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ Back
    document.getElementById('backButton').addEventListener('click', function() {
        this.style.background = '#229954';
        this.style.transform = 'scale(0.95)';
        
        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–∫—Ä—ã—Ç—å –∏–≥—Ä—É —á–µ—Ä–µ–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ
        try {
            window.parent.postMessage({ 
                type: 'CLOSE_GAME',
                gameName: getCurrentGame().name
            }, '*');
        } catch (error) {
            console.log('Could not notify parent, closing locally');
            overlay.style.opacity = '0';
            overlay.style.transition = 'opacity 0.5s';
            setTimeout(() => {
                overlay.remove();
                // –ú–æ–∂–µ–º –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                if (window === window.top) {
                    alert('Game completed! In the full version, this would return to the classroom.');
                }
            }, 500);
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à–∏ Escape
    const escapeHandler = function(e) {
        if (e.key === 'Escape') {
            document.getElementById('backButton').click();
            document.removeEventListener('keydown', escapeHandler);
        }
    };
    document.addEventListener('keydown', escapeHandler);
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
    document.body.style.overflow = 'hidden';
}

// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
function startCompletionMonitoring() {
    const game = getCurrentGame();
    console.log('Starting completion monitor for:', game.name);
    
    // –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏
    const checkInterval = setInterval(() => {
        if (game.completionCondition()) {
            clearInterval(checkInterval);
            setTimeout(() => {
                notifyGameCompletion();
            }, 1000); // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –∏–≥—Ä—ã
        }
    }, 1000);
    
    // –¢–∞–∫–∂–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ "Play Again"
    document.addEventListener('click', function(e) {
        const target = e.target;
        const text = target.textContent || '';
        const className = target.className || '';
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –∫–Ω–æ–ø–∫–æ–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
        if (text.match(/play again|restart|replay|try again|next level|continue/gi) ||
            className.match(/play-again|restart|replay|next-level|continue/gi)) {
            
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            
            console.log('Play Again button intercepted');
            notifyGameCompletion();
            
            return false;
        }
    }, true); // –ò—Å–ø–æ–ª—å–∑—É–µ–º capture –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞
    
    // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    const originalFunctions = {};
    const functionNames = ['endGame', 'gameOver', 'showResults', 'finishGame', 'completeGame', 'winGame'];
    
    functionNames.forEach(funcName => {
        if (typeof window[funcName] === 'function') {
            originalFunctions[funcName] = window[funcName];
            window[funcName] = function(...args) {
                console.log(`Intercepted ${funcName} call`);
                
                // –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                let result;
                if (originalFunctions[funcName]) {
                    result = originalFunctions[funcName].apply(this, args);
                }
                
                // –£–≤–µ–¥–æ–º–ª—è–µ–º –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
                setTimeout(() => {
                    notifyGameCompletion();
                }, 1500);
                
                return result;
            };
        }
    });
    
    // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ URL hash (—á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è)
    let lastHash = window.location.hash;
    const hashCheck = setInterval(() => {
        if (window.location.hash !== lastHash) {
            lastHash = window.location.hash;
            if (lastHash.includes('win') || lastHash.includes('complete') || lastHash.includes('finished')) {
                clearInterval(hashCheck);
                setTimeout(() => {
                    notifyGameCompletion();
                }, 1000);
            }
        }
    }, 500);
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    return () => {
        clearInterval(checkInterval);
    };
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', startCompletionMonitoring);
} else {
    startCompletionMonitoring();
}

// –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
console.log('Game completion handler loaded for:', getCurrentGame().name);

    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à–∏ Escape
    const escapeHandler = function(e) {
        if (e.key === 'Escape') {
            document.getElementById('backButton').click();
        }
    };
    document.addEventListener('keydown', escapeHandler);
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
    document.body.style.overflow = 'hidden';
}

// –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ "Play Again" –∏ "Restart"
function interceptGameButtons() {
    document.addEventListener('click', function(e) {
        const target = e.target;
        const text = (target.innerText || '').toLowerCase();
        
        // –¢–æ–ª—å–∫–æ –±–æ–ª—å—à–∏–µ –∫–Ω–æ–ø–∫–∏ –≤ —Ü–µ–Ω—Ç—Ä–µ —ç–∫—Ä–∞–Ω–∞
        const isLargeButton = target.offsetWidth > 100 && target.offsetHeight > 40;
        const rect = target.getBoundingClientRect();
        const isCentered = Math.abs(rect.left + rect.width/2 - window.innerWidth/2) < 200;
        
        if (isLargeButton && isCentered && (
            text.includes('play again') || 
            text.includes('restart') || 
            text.includes('new game') ||
            text.includes('try again')
        )) {
            console.log('Game restart button intercepted');
            e.preventDefault();
            e.stopPropagation();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
            setTimeout(() => {
                notifyGameCompletion();
            }, 100);
            
            return false;
        }
    }, true); // –ò—Å–ø–æ–ª—å–∑—É–µ–º capture –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
}

// –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
function interceptGameFunctions() {
    // –ü–æ–ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å common game functions
    const functionNames = ['winGame', 'endGame', 'gameOver', 'showResults', 'completeGame'];
    
    functionNames.forEach(funcName => {
        if (typeof window[funcName] === 'function') {
            const originalFunc = window[funcName];
            window[funcName] = function(...args) {
                console.log(`Intercepted ${funcName} in Animal Memory`);
                
                // –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
                const result = originalFunc.apply(this, args);
                
                // –ß–µ—Ä–µ–∑ 1.5 —Å–µ–∫—É–Ω–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—à–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
                setTimeout(() => {
                    notifyGameCompletion();
                }, 1500);
                
                return result;
            };
        }
    });
}

// –ú—è–≥–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ - –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
function startGentleMonitoring() {
    console.log('Starting gentle monitoring for Animal Memory');
    
    let checkCount = 0;
    const maxChecks = 20; // –ú–∞–∫—Å–∏–º—É–º 20 –ø—Ä–æ–≤–µ—Ä–æ–∫ (–ø—Ä–∏–º–µ—Ä–Ω–æ 1 –º–∏–Ω—É—Ç–∞ –∏–≥—Ä—ã)
    
    const checkInterval = setInterval(() => {
        checkCount++;
        
        // –ü—Ä–µ–∫—Ä–∞—â–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ—Å–ª–µ 1 –º–∏–Ω—É—Ç—ã (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
        if (checkCount > maxChecks) {
            clearInterval(checkInterval);
            console.log('Monitoring stopped after 1 minute');
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
        if (checkAnimalMemoryCompletion()) {
            clearInterval(checkInterval);
            console.log('Game completion detected after', checkCount, 'checks');
            
            // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –ø–æ–±–µ–¥—ã
            setTimeout(() => {
                notifyGameCompletion();
            }, 2000);
        }
    }, 3000); // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã!
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
function initializeAnimalMemoryHandler() {
    console.log('Animal Memory completion handler initialized');
    
    // 1. –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
    interceptGameButtons();
    
    // 2. –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏
    interceptGameFunctions();
    
    // 3. –ó–∞–ø—É—Å–∫–∞–µ–º –º—è–≥–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
    setTimeout(() => {
        startGentleMonitoring();
    }, 5000); // –ù–∞—á–∏–Ω–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
    
    // 4. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: –¥–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
    window.completeAnimalGame = notifyGameCompletion;
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('load', function() {
    // –î–∞–µ–º –∏–≥—Ä–µ –≤—Ä–µ–º—è –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
    setTimeout(initializeAnimalMemoryHandler, 1000);
});

console.log('Animal Memory completion handler loaded');
</script>

<style>
/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
#congratulations-overlay button:hover {
    transform: translateY(-3px) !important;
    box-shadow: 0 8px 16px rgba(0,0,0,0.3) !important;
}

#congratulations-overlay button:active {
    transform: translateY(0) !important;
}
<!-- –ö–æ–¥ –¥–ª—è —Å–≤—è–∑–∏ —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –æ–∫–Ω–æ–º -->
<script>
// ============================================
// –ö–û–î –î–õ–Ø –°–í–Ø–ó–ò –° –†–û–î–ò–¢–ï–õ–¨–°–ö–ò–ú –û–ö–ù–û–ú - Animal Memory
// –í—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞, –ø–µ—Ä–µ–¥ </body>
// ============================================

// –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã –¥–ª—è Animal Memory
function checkAnimalMemoryCompletion() {
    console.log('Checking game completion...');
    
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –ø–æ ID
    const winnerModal = document.getElementById('winner-modal');
    console.log('Winner modal found:', winnerModal);
    console.log('Winner modal display style:', winnerModal ? winnerModal.style.display : 'not found');
    
    if (winnerModal && winnerModal.style.display === 'flex') {
        console.log('Game completed: winner modal is visible');
        return true;
    }
    
    // 2. –ò—â–µ–º —Ç–µ–∫—Å—Ç "Game Over!" (–∫–æ—Ç–æ—Ä—ã–π –µ—Å—Ç—å –≤ –≤–∞—à–µ–π –∏–≥—Ä–µ)
    const winnerMessage = document.getElementById('winner-message');
    if (winnerMessage) {
        const text = winnerMessage.textContent || '';
        console.log('Winner message text:', text);
        
        if (text.includes('wins with') || text.includes('Game Over')) {
            console.log('Game completed: winner message found');
            return true;
        }
    }
    
    // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ–≤–ø–∞–ª–∏ —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é gameState
    try {
        if (typeof gameState !== 'undefined') {
            console.log('Game state matchedPairs:', gameState.matchedPairs);
            console.log('Game state total animals:', gameState.animals ? gameState.animals.length : 'undefined');
            
            if (gameState.matchedPairs === 8) { // –í –≤–∞—à–µ–π –∏–≥—Ä–µ 8 –∂–∏–≤–æ—Ç–Ω—ã—Ö
                console.log('Game completed: all pairs matched');
                return true;
            }
        }
    } catch (e) {
        console.error('Error checking gameState:', e);
    }
    
    // 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º—É—é –∫–Ω–æ–ø–∫—É "Play Again"
    const playAgainButton = document.getElementById('play-again');
    console.log('Play Again button found:', playAgainButton);
    console.log('Play Again button visible:', playAgainButton ? playAgainButton.offsetParent !== null : 'not found');
    
    if (playAgainButton && playAgainButton.offsetParent !== null) {
        console.log('Game completed: Play Again button is visible');
        return true;
    }
    
    // 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–µ–∫—Å—Ç "Game Over" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    const pageText = document.body.innerText || '';
    if (pageText.includes('Game Over') && pageText.includes('wins with')) {
        console.log('Game completed: Game Over text found on page');
        return true;
    }
    
    console.log('Game not completed yet');
    return false;
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
function notifyGameCompletion() {
    console.log('Animal Memory Game completion detected');
    
    try {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—é
        window.parent.postMessage({ 
            type: 'GAME_COMPLETED', 
            success: true,
            gameName: 'board', // Work at the Board
            timestamp: new Date().toISOString()
        }, '*');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
        showCongratulations();
        
        return true;
    } catch (error) {
        console.error('Error notifying parent:', error);
        showCongratulations();
        return false;
    }
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–∏–≤—ã–π —ç–∫—Ä–∞–Ω –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
function showCongratulations() {
    console.log('Showing congratulations screen');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ —É–∂–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
    if (document.getElementById('congratulations-overlay')) {
        console.log('Congratulations overlay already showing');
        return;
    }
    
    // –°–∫—Ä—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–±–µ–¥—ã
    const winnerModal = document.getElementById('winner-modal');
    if (winnerModal) {
        winnerModal.style.display = 'none';
        console.log('Original winner modal hidden');
    }
    
    // –°–æ–∑–¥–∞–µ–º –æ–≤–µ—Ä–ª–µ–π
    const overlay = document.createElement('div');
    overlay.id = 'congratulations-overlay';
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 999999;
        color: white;
        font-family: 'Arial', sans-serif;
        text-align: center;
        padding: 20px;
        animation: fadeIn 0.5s ease-out;
    `;
    
    // –°–æ–∑–¥–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    `;
    document.head.appendChild(style);
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∏–≥—Ä—ã
    let winnerText = "Congratulations!";
    try {
        const winnerMessage = document.getElementById('winner-message');
        if (winnerMessage) {
            winnerText = winnerMessage.textContent || "Congratulations!";
        }
    } catch (e) {
        console.log('Could not get winner message:', e);
    }
    
    // –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
    overlay.innerHTML = `
        <div style="font-size: 80px; margin-bottom: 20px; animation: bounce 2s infinite;">
            üêæ
        </div>
        <h1 style="font-size: 42px; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
            ${winnerText}
        </h1>
        <p style="font-size: 24px; margin-bottom: 30px; max-width: 600px; line-height: 1.5;">
            You matched all the animal pairs!<br>
            Fantastic memory, kitty!
        </p>
        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin: 20px 0; backdrop-filter: blur(10px);">
            <p style="font-size: 18px; margin: 10px 0;">üß† Memory game completed!</p>
            <p style="font-size: 18px; margin: 10px 0;">‚≠ê All 8 pairs matched!</p>
            <p style="font-size: 18px; margin: 10px 0;">üê± Your teacher will be proud!</p>
        </div>
        <button id="backButton" style="
            background: #27ae60;
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 22px;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            animation: pulse 2s infinite;
        ">
            üè´ Back to Classroom
        </button>
        <p style="margin-top: 20px; font-size: 16px; color: rgba(255,255,255,0.8);">
            Press ESC or click the button above to return
        </p>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    document.body.appendChild(overlay);
    console.log('Congratulations overlay added');
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ Back
    document.getElementById('backButton').addEventListener('click', function() {
        console.log('Back button clicked');
        this.style.background = '#229954';
        this.style.transform = 'scale(0.95)';
        
        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–∫—Ä—ã—Ç—å –∏–≥—Ä—É —á–µ—Ä–µ–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ
        try {
            window.parent.postMessage({ 
                type: 'CLOSE_GAME',
                gameName: 'board'
            }, '*');
            console.log('Close message sent to parent');
        } catch (error) {
            console.log('Could not notify parent, closing locally');
            overlay.style.opacity = '0';
            overlay.style.transition = 'opacity 0.5s';
            setTimeout(() => {
                overlay.remove();
                // –ú–æ–∂–µ–º –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                if (window === window.top) {
                    alert('Game completed! In the full version, this would return to the classroom.');
                }
            }, 500);
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à–∏ Escape
    const escapeHandler = function(e) {
        if (e.key === 'Escape') {
            document.getElementById('backButton').click();
        }
    };
    document.addEventListener('keydown', escapeHandler);
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
    document.body.style.overflow = 'hidden';
    console.log('Congratulations screen fully setup');
}

// –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "Play Again" –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∏–≥—Ä—ã
function interceptPlayAgainButton() {
    const originalPlayAgainButton = document.getElementById('play-again');
    if (originalPlayAgainButton) {
        console.log('Found original Play Again button, adding listener');
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        const originalOnClick = originalPlayAgainButton.onclick;
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫–ª–∏–∫
        originalPlayAgainButton.addEventListener('click', function(e) {
            console.log('Original Play Again button clicked - intercepted');
            e.preventDefault();
            e.stopPropagation();
            
            // –í–º–µ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
            notifyGameCompletion();
            
            return false;
        }, true);
    }
}

// –ú—è–≥–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ - –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
function startGentleMonitoring() {
    console.log('Starting gentle monitoring for Animal Memory');
    
    let checkCount = 0;
    const maxChecks = 60; // –ú–∞–∫—Å–∏–º—É–º 60 –ø—Ä–æ–≤–µ—Ä–æ–∫ (3 –º–∏–Ω—É—Ç—ã –∏–≥—Ä—ã)
    
    const checkInterval = setInterval(() => {
        checkCount++;
        
        // –ü—Ä–µ–∫—Ä–∞—â–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ—Å–ª–µ 3 –º–∏–Ω—É—Ç (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
        if (checkCount > maxChecks) {
            clearInterval(checkInterval);
            console.log('Monitoring stopped after 3 minutes');
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
        if (checkAnimalMemoryCompletion()) {
            clearInterval(checkInterval);
            console.log('Game completion detected after', checkCount, 'checks');
            
            // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –ø–æ–±–µ–¥—ã
            setTimeout(() => {
                notifyGameCompletion();
            }, 2000);
        }
    }, 3000); // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã!
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
function initializeAnimalMemoryHandler() {
    console.log('Animal Memory completion handler initialized');
    
    // 1. –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É Play Again
    interceptPlayAgainButton();
    
    // 2. –ó–∞–ø—É—Å–∫–∞–µ–º –º—è–≥–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
    setTimeout(() => {
        startGentleMonitoring();
    }, 5000); // –ù–∞—á–∏–Ω–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
    
    // 3. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: –¥–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
    window.completeAnimalGame = notifyGameCompletion;
    
    console.log('Animal Memory handler setup complete');
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('load', function() {
    // –î–∞–µ–º –∏–≥—Ä–µ –≤—Ä–µ–º—è –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
    setTimeout(initializeAnimalMemoryHandler, 1000);
});

console.log('Animal Memory completion handler loaded');
</script>

<style>
/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
#congratulations-overlay button:hover {
    transform: translateY(-3px) !important;
    box-shadow: 0 8px 16px rgba(0,0,0,0.3) !important;
}

#congratulations-overlay button:active {
    transform: translateY(0) !important;
}
</style>

</body>
</html>